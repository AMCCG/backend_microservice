// Pipeline Declarative คือ Syntax ที่ขึ้นต้นด้วยคำว่า Pipeline
pipeline {
    // agent :คือการบอกว่า จะจำกัดเงื่อนไขในการสั่ง execute task ไปที่ใดบ้างถ้าใช้ any ก็คือไม่มีข้อจำกัดใดๆ
    agent any

     environment {

     }
     /*
     stages :คือ root path หลักในการประกอบงานระดับ stage เข้ามาด้วยกันซึ่งถ้าถามว่า stage จะสื่อถึงอะไร ?
     stage ก็เปรียบเสมือนสายพานผลิตแบบยาวๆซึ่งจะเริ่มตั้งแต่ การ load อะไหล่เข้ามากองรวมกัน การประกอบอะไหล่
     และพอประกอบเสร็จก็เทสว่าอะไหล่หลายส่วนทำงานร่วมกันได้มั้ย โดยส่งไปที่ห้องทดลองแรกทดสอบกันน้ำ
     และก็ส่งไปห้องกันกระแทก ทดสอบ long term ว่าอุปกรณ์ใช้งานได้จริงๆไหมหากเปิดทำงานต่อเนื่องกัน ซึ่งตรงนี้คือ stage นั่นเอง
     แต่ถ้าเรามาดูที่ steps ที่อยู่ใน stage ก็จะเป้นขั้นตอนย่อยๆซึ่งต้องการความละเอียดทุกๆขั้นตอนในการทำงานตัวอย่างเช่น
     การโหลดอะไหล่เข้ามา ก็ต้องดูว่าแล้วอะไหล่อะไรที่ต้องใช้ จะโหลดจากไหน ? โหลดเสร็จแล้วต้องส่งไปที่สายพานไหนต่อ
     แล้วกล่องที่ใช้แพ็คอะไหล่หลังจาก load ชื่อว่าอะไร ? คนต่อไปหากจะใช้ของที่ pack มาต้องหากล่องชื่อว่าอะไรนั่นเอง
     */
     stages {
        // เป็นส่วนทดสอบตัวแปร env ต่างๆซึ่ง Jenkins จะมีตัวแปรบางตัวที่มาพร้อมอยู่แล้วเป็น Global Variable ก็จะเรียกใช้ชื่อตัวแปรเหล่านั้นได้เลย
        // จากตัวอย่างคือเรามีการใช้ Plugin GIT (Pre-Load) มาแล้วเราไม่ต้องลงที่เราใช้ Git ได้ก็เพราะ Plugin Git นั่นเอง
        // สามารถเข้าไปดูตัวแปรจาก Plugin ได้ที่ส่วนของ Environment https://plugins.jenkins.io/git/
        // stage จะเป็นการตั้งชื่อเฉยๆให้เห็นบน Ocean Blue GUI
        stage('Setup Default ENV') {
            steps {
                echo '=========== Verify Branch ============'
                echo "${GIT_BRANCH}"
                script {
                    // ตั้ง default tag สำหรับ branch อื่นๆที่ไมไ่ด้ build ผ่าน master
                    // ซึ่งตัวแปร env ที่เราสร้างเองจะนำหน้าด้วย env.ENV_NAME เสมอและจากนั้นตัวแปรก็จะมองเห็นระดับ global ข้ามไปหานอก block code ได้
                    env.BUILD_BRANCH = "${GIT_BRANCH}-"
                    env.TAG_VERSION = "${BUILD_ID}"
                }
                echo "${env.BUILD_BRANCH}"
            }
        }
     }
}